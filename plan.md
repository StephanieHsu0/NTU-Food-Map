# 專案開發計畫：台大美食推薦平台

本文件記錄專案目前的完成狀況，以及接下來的開發目標與細項規劃。

---

## 1. 目前進度 (Current Status)

### ✅ 已完成項目

#### [x] 地圖整合
- ✅ 成功整合 Leaflet 地圖庫（使用 OpenStreetMap 圖資）
- ✅ 地圖可正常載入與顯示

#### [x] 網站基礎頁面
- ✅ 完成前端專案建置（Next.js 14 + TypeScript）
- ✅ 基礎 Layout 與頁面 route 設定完成
- ✅ 多語言支援（中英文，使用 next-intl）
- ✅ 響應式設計（Tailwind CSS）

#### [x] UI/UX 基礎功能
- ✅ 完成介面原型設計
- ✅ 確立使用者操作流程（User Flow）
- ✅ 側邊欄地點列表顯示
- ✅ 地點卡片（PlaceCard）組件
- ✅ 篩選器（Filters）組件
- ✅ 地點詳情頁面

#### [x] 後端 API 開發
- ✅ Express 後端伺服器建置
- ✅ MongoDB 資料庫整合（MongoDB Atlas）
- ✅ 地點查詢 API (`GET /api/places`)
- ✅ 地點詳情 API (`GET /api/places/:id`)
- ✅ 轉盤隨機選擇 API (`POST /api/roulette`)
- ✅ 地理空間查詢（Geospatial Queries）
- ✅ 智能推薦評分系統（距離、評分、人氣、營業狀態等）

#### [x] 資料管理
- ✅ 資料庫 Schema 設計
- ✅ 資料匯入腳本（`scripts/import_to_db.js`）
- ✅ Google Places API 資料擷取腳本（`scripts/fetch_places.js`）

---

## 2. 預期開發項目 (Planned Features)

### 🚀 階段一：會員系統整合 (Google OAuth)

**目標**：讓使用者能夠登入系統，並在雲端儲存他們的資料，實現跨裝置存取。**（評價系統的前置需求）**

#### [ ] 環境建置
- [ ] 設定 Google Cloud Console 專案（OAuth Client ID/Secret）
- [ ] 設定 `.env` 環境變數（`GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `NEXTAUTH_SECRET`, `NEXTAUTH_URL`）
- [ ] 安裝 NextAuth.js 相關套件

#### [ ] 後端/Auth 實作
- [ ] 整合 NextAuth.js 進行 Google 登入
- [ ] 實作登入（Sign In）與登出（Sign Out）邏輯
- [ ] 處理 Session 狀態管理（保護特定路由）
- [ ] 建立 Auth API Routes（`/api/auth/[...nextauth]`）

#### [ ] 資料庫整合
- [ ] 設計 User Schema（儲存 User ID, Email, Name, Avatar, Created At）
- [ ] 實作使用者資料儲存 API
- [ ] 建立使用者資料庫集合（Collection）
- [ ] 實作使用者資料查詢與更新邏輯

#### [ ] 前端整合
- [ ] 建立登入/登出按鈕組件
- [ ] 實作受保護路由（Protected Routes）
- [ ] 顯示使用者資訊（頭像、名稱）
- [ ] 處理未登入狀態的 UI 顯示

---

### ⭐ 階段二：餐廳評價系統 (Restaurant Review System) - **核心功能**

**目標**：讓使用者可以對附近的餐廳進行評價，包含評論、評分、類別標記、價格區間等資訊，並讓其他使用者可以查看這些評價。

#### [ ] 資料結構設計
- [ ] 設計評價資料結構（Review Schema）：
  - 評價 ID、地點 ID（關聯到 places 集合）
  - 使用者 ID（關聯到 users 集合）
  - 評分（1-5 星）
  - 評論內容（文字）
  - 類別標記（如：中式、西式、日式、韓式、泰式、素食、咖啡廳等）
  - 價格區間（1-4，對應 $、$$、$$$、$$$$）
  - 建立時間、更新時間
  - 有用數（Helpful Count）
  - 照片（可選，使用者上傳的照片）
- [ ] 建立資料庫 Schema（`reviews` 集合）
- [ ] 設計評價統計資料結構（地點的聚合評分、評價數量等）
- [ ] 建立必要的索引（地點 ID、使用者 ID、建立時間等）

#### [ ] 評價提交功能
- [ ] 實作評價表單 UI 組件
  - 評分選擇器（星級評分）
  - 評論文字輸入框（多行文字）
  - 類別選擇器（多選，如：中式、西式、日式等）
  - 價格區間選擇器（單選，1-4）
  - 照片上傳功能（可選）
- [ ] 實作評價提交 API（`POST /api/reviews`）
  - 驗證使用者已登入
  - 驗證地點存在
  - 驗證使用者是否已對該地點評價過（可選：允許更新或限制一地點一評價）
  - 儲存評價資料
- [ ] 實作評價更新 API（`PUT /api/reviews/:id`）
  - 驗證使用者擁有該評價
  - 更新評價內容
- [ ] 實作評價刪除 API（`DELETE /api/reviews/:id`）
  - 驗證使用者擁有該評價
  - 刪除評價資料

#### [ ] 評價查看功能
- [ ] 實作地點詳情頁面的評價列表
  - 顯示該地點的所有評價
  - 評價排序（最新、最舊、評分最高、評分最低、最有用）
  - 評價分頁（Pagination）
- [ ] 實作評價卡片組件
  - 顯示使用者頭像、名稱
  - 顯示評分（星級顯示）
  - 顯示評論內容
  - 顯示類別標籤
  - 顯示價格區間
  - 顯示建立時間
  - 顯示照片（如果有）
  - 「有用」按鈕（Helpful Button）
- [ ] 實作評價統計顯示
  - 平均評分（基於所有使用者評價）
  - 評價總數
  - 評分分布（1-5 星各有多少評價）
  - 類別分布（各類別出現頻率）
  - 價格區間分布
- [ ] 實作評價篩選功能
  - 依評分篩選（1-5 星）
  - 依類別篩選
  - 依價格區間篩選
  - 只顯示有照片的評價

#### [ ] 地圖整合
- [ ] 在地圖標記點上顯示評價統計（平均評分、評價數量）
- [ ] 在地點詳情頁面整合評價功能
  - 「撰寫評價」按鈕（需登入）
  - 評價列表區塊
- [ ] 實作從地圖快速評價功能
  - 點擊地圖標記點後，可直接開啟評價表單

#### [ ] 評價聚合與統計
- [ ] 實作評價統計計算 API（`GET /api/places/:id/reviews/stats`）
  - 計算平均評分
  - 計算評分分布
  - 計算類別分布
  - 計算價格區間分布
- [ ] 實作地點評分更新機制
  - 當有新的評價時，自動更新地點的平均評分
  - 更新地點的評價數量
- [ ] 實作評價查詢 API（`GET /api/reviews`）
  - 依地點 ID 查詢
  - 依使用者 ID 查詢（「我的評價」）
  - 支援排序與分頁

#### [ ] 社交互動功能
- [ ] 實作「有用」功能（Helpful）
  - 使用者可以標記評價為「有用」
  - 記錄「有用」數量
  - 防止重複點擊（同一使用者只能點一次）
- [ ] 實作評價回覆功能（可選）
  - 允許店家或使用者回覆評價
- [ ] 實作評價舉報功能
  - 允許使用者舉報不當評價
  - 管理員審核機制（未來功能）

#### [ ] 使用者個人評價管理
- [ ] 實作「我的評價」頁面
  - 顯示使用者撰寫的所有評價
  - 允許編輯與刪除
  - 顯示評價狀態（已發布、已刪除等）
- [ ] 實作評價草稿功能（可選）
  - 允許使用者儲存未完成的評價

---

### 🎡 階段三：進階功能與優化 (Advanced Features)

**目標**：增強評價系統的實用性與使用者體驗。

#### [ ] 評價推薦與篩選增強
- [ ] 實作基於評價的智能推薦
  - 根據使用者的評價歷史推薦相似餐廳
  - 根據類別偏好推薦
- [ ] 實作評價搜尋功能
  - 在評價內容中搜尋關鍵字
  - 依評論內容篩選
- [ ] 實作評價標籤系統
  - 自動提取評價中的關鍵字作為標籤
  - 或允許使用者手動添加標籤

#### [ ] 評價視覺化
- [ ] 實作評價趨勢圖表
  - 顯示地點評分隨時間的變化
  - 顯示評價數量隨時間的變化
- [ ] 實作評價熱力圖
  - 在地圖上顯示評價密度
  - 顯示高評價區域

#### [ ] 轉盤決策功能（基於評價）
- [ ] 實作基於評價的轉盤功能
  - 從高評價餐廳中隨機選擇
  - 根據類別、價格區間篩選後轉盤
  - 顯示選中餐廳的評價摘要

---

## 3. 待辦事項 (Backlog / Nice to have)

### 未來可考慮加入的功能

#### [ ] 評價系統增強
- [ ] 實作評價驗證機制（確保評價真實性）
- [ ] 實作評價排序演算法優化（考慮時間、有用數、評分等）
- [ ] 實作評價自動分類（使用 NLP 分析評論內容）
- [ ] 實作評價情感分析（正面/負面評價分析）
- [ ] 實作評價關鍵字雲（Word Cloud）

#### [ ] 地點詳細資訊增強
- [ ] 串接 Google Places API 顯示營業時間
- [ ] 顯示地點照片（Google Places Photos）
- [ ] 整合 Google Places 的官方評分與使用者評價
- [ ] 顯示地點標籤與特色（Features）

#### [ ] 社交功能
- [ ] 實作地點收藏功能（Favorites）
- [ ] 實作追蹤其他使用者功能（Follow Users）
- [ ] 實作評價通知功能（當追蹤的使用者發布新評價時通知）
- [ ] 實作評價討論區（針對特定評價的討論串）

#### [ ] 推薦系統
- [ ] 實作基於評價的個人化推薦
- [ ] 實作「相似使用者」推薦（基於評價歷史）
- [ ] 實作「你可能會喜歡」功能
- [ ] 實作評價趨勢預測

#### [ ] 進階篩選與搜尋
- [ ] 實作評價內容全文搜尋
- [ ] 實作多條件組合篩選（評分 + 類別 + 價格 + 距離）
- [ ] 實作自訂篩選條件儲存
- [ ] 實作篩選條件分享

#### [ ] 評價品質管理
- [ ] 實作評價長度要求（最少字數）
- [ ] 實作評價內容審核機制（過濾不當內容）
- [ ] 實作評價真實性驗證（防止假評價）
- [ ] 實作評價獎勵機制（鼓勵優質評價）

#### [ ] 效能優化
- [ ] 實作地圖標記點聚合（Marker Clustering）優化
- [ ] 實作資料快取機制（Redis）
- [ ] 實作 API 回應快取
- [ ] 優化圖片載入（Lazy Loading）
- [ ] 優化評價列表載入效能（虛擬滾動）

#### [ ] 行動裝置優化
- [ ] 優化行動裝置地圖體驗
- [ ] 實作 PWA（Progressive Web App）功能
- [ ] 實作離線模式（Offline Mode）
- [ ] 優化行動裝置評價表單體驗

---

## 4. 技術債務 (Technical Debt)

### 需要改進的項目

- [ ] 將地圖從 Leaflet 遷移至 Google Maps（如需要 Google Places 完整整合）
- [ ] 實作完整的錯誤處理機制
- [ ] 增加單元測試與整合測試（特別是評價系統相關功能）
- [ ] 實作 API 速率限制（Rate Limiting，防止評價濫用）
- [ ] 優化資料庫查詢效能（索引優化，特別是評價查詢）
- [ ] 實作日誌系統（Logging System）
- [ ] 實作評價資料備份機制
- [ ] 優化評價聚合查詢效能（考慮使用 MongoDB Aggregation Pipeline 優化）
- [ ] 實作評價內容安全過濾（防止 XSS、不當內容等）

---

## 5. 開發時程預估 (Timeline Estimate)

### 階段一：會員系統整合
**預估時間**：2-3 週
- 環境建置：1-2 天
- 後端實作：3-5 天
- 資料庫整合：2-3 天
- 前端整合：3-5 天
- 測試與除錯：2-3 天

### 階段二：餐廳評價系統（核心功能）
**預估時間**：4-6 週
- 資料結構設計：2-3 天
- 評價提交功能（後端 + 前端）：5-7 天
- 評價查看功能（列表、卡片、統計）：7-10 天
- 地圖整合：3-5 天
- 評價聚合與統計：3-5 天
- 社交互動功能（有用、回覆等）：3-5 天
- 使用者個人評價管理：2-3 天
- 測試與除錯：5-7 天

### 階段三：進階功能與優化
**預估時間**：3-4 週
- 評價推薦與篩選增強：5-7 天
- 評價視覺化：3-5 天
- 轉盤決策功能（基於評價）：3-5 天
- 評價匯出與分享：2-3 天
- 測試與除錯：3-5 天

**總預估時間**：9-13 週（約 2.5-3 個月）

### 開發優先順序建議
1. **第一優先**：階段一（會員系統）- 評價系統的前置需求
2. **第二優先**：階段二的核心功能（評價提交、查看、統計）
3. **第三優先**：階段二的進階功能（社交互動、個人管理）
4. **第四優先**：階段三的進階功能

---

## 6. 備註 (Notes)

- 本計畫為動態文件，會根據開發進度與需求變更持續更新
- 各階段可視情況調整優先順序
- 建議採用敏捷開發方式，分階段交付功能
- 每個階段完成後應進行測試與使用者回饋收集

---

---

## 7. 評價系統設計細節 (Review System Design Details)

### 評價資料結構範例

```typescript
interface Review {
  _id: ObjectId;
  place_id: string;           // 關聯到 places.id
  user_id: string;             // 關聯到 users.id
  rating: number;              // 1-5 星評分
  comment: string;             // 評論內容
  categories: string[];        // 類別標記，如：["中式", "餐廳", "素食"]
  price_range: number;         // 價格區間：1-4
  photos?: string[];           // 使用者上傳的照片 URL
  helpful_count: number;       // 有用數
  created_at: Date;
  updated_at: Date;
}

interface ReviewStats {
  place_id: string;
  average_rating: number;      // 平均評分
  total_reviews: number;       // 評價總數
  rating_distribution: {      // 評分分布
    1: number;
    2: number;
    3: number;
    4: number;
    5: number;
  };
  category_distribution: {    // 類別分布
    [category: string]: number;
  };
  price_range_distribution: { // 價格區間分布
    1: number;
    2: number;
    3: number;
    4: number;
  };
}
```

### API 端點規劃

```
POST   /api/reviews              # 建立新評價
GET    /api/reviews              # 查詢評價（支援篩選、排序、分頁）
GET    /api/reviews/:id          # 取得單一評價詳情
PUT    /api/reviews/:id          # 更新評價
DELETE /api/reviews/:id          # 刪除評價
POST   /api/reviews/:id/helpful  # 標記評價為有用
GET    /api/places/:id/reviews   # 取得地點的所有評價
GET    /api/places/:id/reviews/stats  # 取得地點的評價統計
GET    /api/users/:id/reviews    # 取得使用者的所有評價
```

### 類別標記系統

預定義的類別選項：
- **菜系類型**：中式、西式、日式、韓式、泰式、義式、美式、法式、其他
- **餐廳類型**：餐廳、小吃、夜市、咖啡廳、甜點、飲料、速食、火鍋、燒烤、素食
- **特色標籤**：適合聚餐、適合約會、適合工作、適合學生、平價、高級、24小時營業

---

**最後更新日期**：2024-12-19

